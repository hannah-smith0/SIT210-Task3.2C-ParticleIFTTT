//Constants
#define LIGHTPIN A0     //Pin that receives the light data

#define PUBLISH_DELAY 15000 //15 seconds delay between publishing to avoid sending too often

#define LIGHT_THRESHOLD 300 //The threshold for detecting sunlight


//Variables
int lightLevel; // The readings from the light sensor

int sunny = 0;  //0 for false, 1 for true


//Setup
void setup() 
{
    //Particle variables to be read by IFTTT
    Particle.variable("sunlightDetected", &sunny, INT);
    pinMode(LIGHTPIN, INPUT);
}


//Loop
void loop() 
{
    //Gathers sensor data
    //lightLevel = analogRead(LIGHTPIN);
    lightLevel = random(100,1000); //dummy value for testing purposes
    
    //Publishes sensor data to ThingSpeak
    String lightString = String(lightLevel);
    Particle.publish("sunlight", lightString, PRIVATE);
    
    //Checks to see if the threshold is being crossed
    if (sunny == 0 && lightLevel >= LIGHT_THRESHOLD)
    {
        sunny = 1;
    }
    if (sunny == 1 && lightLevel < LIGHT_THRESHOLD)
    {
        sunny = 0;
    }
    
    //Waits for the set delay time
    delay(PUBLISH_DELAY);

}
