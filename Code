//Constants
#define PUBLISH_DELAY 15000 //15 seconds delay between publishing to avoid sending too often

#define LIGHT_THRESHOLD 15 //The threshold for detecting sunlight


//Variables
int photoresistor = A0; // The readings from the light sensor

int lightLevel;  //An int to describe the reading

int sunny = 0;  //Starts as -1 so it doesn't trigger the IFTTT if there's no sun


//Setup
void setup() 
{
    //Particle variables to be read by IFTTT
    Particle.variable("sunlightDetected", &sunny, INT);
    pinMode(photoresistor, INPUT);
}


//Loop
void loop() 
{
    //Gathers sensor data
    lightLevel = analogRead(photoresistor);
    
    //lightLevel = random(100,1000); //dummy value for testing purposes
    
    String lightString = String(lightLevel);  //string for sending to ThingSpeak
    
    //Publishes sensor data to ThingSpeak
    Particle.publish("sunlight", lightString, PRIVATE);
    
    //Checks if the light level has gone over the threshold
    //This stops the system from spamming. It only sends messages if there is a change in conditions
    if (sunny == 0 && lightLevel >= LIGHT_THRESHOLD)
    {
        //This will trigger the IFTTT to fire a "sunlight detected" event
        sunny = 1;
    }
    if (sunny == 1 && lightLevel < LIGHT_THRESHOLD)
    {
        //Fires the "dark" trigger
        sunny = 0;
    }
    

    
    //Waits for the set delay time
    delay(PUBLISH_DELAY);

}
